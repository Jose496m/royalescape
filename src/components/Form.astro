---
import Button from "./Button.astro";
---

<section>
  <h2>Giv din mening</h2>
  <p>Vi er meget interesseret i at høre din mening, så vi kan forbedre din oplvelse så vidt muligt</p>
  <form>
    <input type="text" id="name" name="name" placeholder="DIT NAVN" />
    <textarea id="description" name="description" placeholder="DIN OPLEVELSE"></textarea>
  </form>
  <Button title="INDSEND" />
</section>

<script>
  function addTestimonial(newTestimonial) {
    //dette er funktionen der putter data i tabbellen i databasen

    const url = "https://uqqrfignuxyaogcxautj.supabase.co/rest/v1/Testimonials?limit=3";
    const api = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVxcXJmaWdudXh5YW9nY3hhdXRqIiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODE0NTU5OTksImV4cCI6MTk5NzAzMTk5OX0.FrC343CmVCw8w5fWd3KEeT9N5uSROAJDXMIzKt4qbNw";

    const options = {
      method: "POST", //post gør at den putter noget i tabellen istedet for at hente
      headers: {
        apikey: api,
        Authorization: "Bearer " + api,
        "Content-Type": "application/json",
        Prefer: "return=representation",
      },
      body: JSON.stringify(newTestimonial), //laver variablen newTestimonial til json (her er det et objekt med 2 værdier)
    };

    console.log("options:", options);

    fetch(url, options)
      .then((res) => res.json())
      .then((data) => {
        console.log("data:", data);
        //når dden er færdig med at putte i databasen går den til filen addTestimonialfeedback "/" er for at sikre at den leder i roden
        window.location.href = "/addTestimonialFeedback";
      });
  }

  const form = document.querySelector("form");
  console.log("form.elements", form.elements);

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const obj = {
      title: form.elements.title.value,
      description: form.elements.long.value,
    };

    addTestimonial(obj);
  });
</script>

<style>
  form {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  input {
    display: block;
    width: 350px;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-bottom: 3rem;
    color: #999;
  }
  section {
    display: block;
    padding: 5rem;
    text-align: center;
  }
  textarea {
    resize: none;
    height: 100px;
    width: 350px;
    display: block;
    padding: 4px;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-bottom: 3rem;
    color: #999;
  }
  input::placeholder,
  textarea::placeholder {
    color: #999;
    font-family: "Cinzel", serif;
    font-size: 1rem;
  }
  h2,
  p {
    text-align: center;
    color: white;
    margin-bottom: 2rem;
    font-size: 1rem;
    font-family: "Cinzel", serif;
  }
</style>
